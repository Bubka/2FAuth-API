openapi: 3.1.0
info:
  title: 2fauth-0.1.0
  version: 0.1.0
servers:
  - url: 'http://localhost:3000'
paths:
  /api/v1/twofaccounts:
    get:
      summary: Get all 2FA accounts
      tags:
        - twofaccounts
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/2FAccountCollection'
              examples: {}
        '401':
          $ref: '#/components/responses/Unauthorized'
      operationId: get-twofaccounts
      description: Find all existing 2FA accounts
      parameters:
        - $ref: '#/components/parameters/withSecret'
    parameters: []
    post:
      summary: Create 2FA account
      tags:
        - twofaccounts
      operationId: post-twofaccounts
      description: Creates a new 2FA account
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/2FAccountStore'
                - $ref: '#/components/schemas/OtpauthUri'
            examples:
              Example with properties:
                value:
                  service: MySite
                  account: john.doe
                  icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
                  otp_type: totp
                  digits: 6
                  algorithm: sha1
                  secret: GJTGC5LUNA
                  period: 30
                  counter: null
              Example with URI:
                value:
                  uri: 'otpauth://totp/MySite:john.doe?secret=GJTGC5LUNA&issuer=MySite&period=30&algorithm=sha1&digits=6&image=https://www.example.com/image.png'
        description: |-
          This endpoint accepts 2 different body schemas to create a new 2FA account:
          - A full JSON object with some properties
          - An URI based on the otpauth format
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/2FAccountRead'
              examples: {}
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      parameters:
        - $ref: '#/components/parameters/withSecret'
  '/api/v1/twofaccounts/{id}':
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      summary: Find 2FA account by ID
      tags:
        - twofaccounts
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/2FAccountRead'
              examples: {}
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      operationId: get-twofaccounts-id
      description: Returns a single 2FA account
      parameters:
        - $ref: '#/components/parameters/withSecret'
    put:
      summary: Update 2FA account
      operationId: put-twofaccounts-id
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/2FAccountRead'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
      description: Creates a 2FA account
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/2FAccountUpdate'
            examples: {}
      tags:
        - twofaccounts
  '/api/v1/twofaccounts/{id}/qrcode':
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      summary: Get as a QR code
      tags:
        - twofaccounts
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: ''
                type: object
                x-examples:
                  example-1:
                    qrcode: 'data:image/png;base64,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'
                properties:
                  qrcode:
                    type: string
                    example: 'data:image/png;base64,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'
                required:
                  - qrcode
              examples:
                Example:
                  value:
                    qrcode: 'data:image/png;base64,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'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      operationId: get-twofaccounts-id-qrcode
      description: Returns a QR code that represents the 2FA account
  '/api/v1/twofaccounts/{id}/otp':
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          example: 1
        description: The ID of the resource
    get:
      summary: Get a One-Time password
      tags:
        - twofaccounts
        - One-Time Password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Otp'
              examples: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      operationId: get-twofaccounts-id-otp
      description: Returns a fresh One-Time Password with related parameters for the existing account matching the specified ID
  /api/v1/twofaccounts/otp:
    parameters: []
    post:
      summary: Get a One-Time password
      tags:
        - twofaccounts
        - One-Time Password
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/2FAccountStore'
                - $ref: '#/components/schemas/OtpauthUri'
            examples: {}
        description: |-
          This endpoint accepts 2 different body schemas to generate a One-Time Password:
          - A JSON object with all properties to define a 2FA account
          - An otpauth URI
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Otp'
              examples: {}
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      operationId: post-twofaccounts-otp
      description: Returns a fresh One-Time password with related parameters for account defined by the provided data
  /api/v1/twofaccounts/preview:
    post:
      summary: Preview 2FA account
      operationId: post-twofaccounts-preview
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/2FAccountRead'
              examples: {}
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      description: |-
        Use this endpoint to preview a 2FA account described by an otpauth URI.
        It works exactly as if you POSTed an URI to create a 2FA account except it does not save anything in database.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OtpauthUri'
        description: ''
      tags:
        - twofaccounts
  /api/v1/twofaccounts/reorder:
    post:
      summary: Save order of the 2FA accounts collection
      operationId: post-twofaccounts-reorder
      responses:
        '200':
          $ref: '#/components/responses/OK'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      description: Saves the order of 2FA accounts. This allows to always serve the 2FA accounts collection sorted in a user defined order.
      requestBody:
        content:
          application/json:
            schema:
              description: ''
              type: object
              properties:
                orderedIds:
                  type: array
                  uniqueItems: true
                  description: An array of 2FA account IDs ordered in the wished order
                  items:
                    type: integer
              required:
                - orderedIds
            examples:
              Example:
                value:
                  orderedIds:
                    - 3
                    - 1
                    - 4
                    - 2
        description: ''
      tags:
        - twofaccounts
  /api/v1/groups:
    get:
      summary: Get all groups
      tags:
        - groups
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupCollection'
        '401':
          $ref: '#/components/responses/Unauthorized'
      operationId: get-groups
      description: Find all existing groups
    post:
      summary: ''
      operationId: post-api-v1-groups
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupRead'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupStore'
            examples: {}
      tags:
        - groups
  '/api/v1/groups/{id}':
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      summary: Find group by ID
      tags:
        - groups
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupRead'
              examples: {}
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      operationId: get-groups-id
      description: Returns a single group
    put:
      summary: ''
      operationId: put-groups-id
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupRead'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
      description: Updates a group
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GroupStore'
  /api/v1/auth/login:
    post:
      summary: Sign in
      tags:
        - auth
      responses:
        '200':
          $ref: '#/components/responses/Authenticated'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          description: Too Many Requests
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                Example:
                  value:
                    message: Too many login attempts. Please try again in 30 seconds.
      operationId: post-login
      description: Authenticates using the submitted credential
      parameters: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              description: ''
              type: object
              x-examples:
                example-1:
                  email: edouard@ganeau.me
                  password: '}egjI84(T)v.d''#|x^eI'
              properties:
                email:
                  type: string
                  description: Email of the registered user
                  format: email
                password:
                  type: string
                  description: Password of the registered user
                  format: password
              required:
                - email
                - password
            examples:
              Example:
                value:
                  email: john.doe@example.com
                  password: '^13,xgtG$*7js++}Cl#v'
    parameters: []
  /api/v1/auth/logout:
    post:
      summary: Sign out
      tags:
        - auth
      responses:
        '200':
          $ref: '#/components/responses/OK'
        '401':
          $ref: '#/components/responses/Unauthorized'
      operationId: post-logout
      description: Terminates the current user session
    parameters: []
  /api/v1/auth/register:
    post:
      summary: Register new user
      tags:
        - auth
      responses:
        '200':
          $ref: '#/components/responses/Authenticated'
        '422':
          $ref: '#/components/responses/ValidationError'
      operationId: post-register
      description: Creates a new user account
      requestBody:
        content:
          multipart/form-data:
            schema:
              description: ''
              type: object
              x-examples:
                example-1:
                  name: toto
                  email: edouard@ganeau.me
                  password: toto
                  password_confirmation: toto
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: john.doe
                  description: The account username
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: john.doe@example.com
                  description: The account email address
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: '^13,xgtG$*7js++}Cl#v'
                  description: The account password
                password_confirmation:
                  type: string
                  format: password
                  minLength: 8
                  example: '^13,xgtG$*7js++}Cl#v'
                  description: The confirmed account username
              required:
                - name
                - email
                - password
                - password_confirmation
            examples:
              Example:
                value:
                  name: john.doe
                  email: john.doe@example.com
                  password: '^13,xgtG$*7js++}Cl#v'
                  password_confirmation: '^13,xgtG$*7js++}Cl#v'
        description: ''
    parameters: []
  /api/v1/icons:
    post:
      summary: Upload an icon
      tags:
        - icons
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                description: ''
                type: object
                x-examples:
                  example-1:
                    filename: wspRWRSCo62kY76JFquzqq8Y2jJO1iEowZ3JsMCw.png
                properties:
                  filename:
                    type: string
                    example: wspRWRSCo62kY76JFquzqq8Y2jJO1iEowZ3JsMCw.png
                    description: The icon filename
                required:
                  - filename
              examples:
                Example:
                  value:
                    filename: wspRWRSCo62kY76JFquzqq8Y2jJO1iEowZ3JsMCw.png
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      operationId: post-icons
      description: 'Use this endpoint to upload and store an icon (an image file: jpeg, png, bmp, gif, svg, or webp) on the server'
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              format: binary
              properties:
                icon:
                  type: string
                  description: An image file
              required:
                - icon
            examples:
              Example:
                value:
                  icon: string
        description: ''
    parameters: []
  '/api/v1/icons/{filename}':
    parameters:
      - schema:
          type: string
          example: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
        name: filename
        in: path
        required: true
        description: Filename (with extension) of the icon file to delete from the server
    delete:
      summary: Delete an icon
      operationId: delete-api-v1-icons-filename
      responses:
        '204':
          description: No Content
        '401':
          $ref: '#/components/responses/Unauthorized'
      description: Deletes an icon from the server
      tags:
        - icons
  /api/v1/qrcode/decode:
    post:
      summary: Decode a QR code
      operationId: post-qrcode-decode
      description: 'Use this endpoint to decode a QR code (an image file: jpeg, png, bmp, gif, svg, or webp)'
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              format: binary
              properties:
                qrcode:
                  type: string
                  description: A QR code image file
              required:
                - qrcode
            examples:
              Example:
                value:
                  qrcode: string
        description: ''
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                description: ''
                type: object
                x-examples:
                  example-1:
                    data: 'otpauth://totp/Mysite:john.doe?issuer=Mysite&secret=J52HAU3FMNZGK5A'
                properties:
                  data:
                    type: string
                    example: 'otpauth://totp/MySite:john.doe?secret=GJTGC5LUNA'
                    description: The data encoded in the QR code
                required:
                  - data
              examples:
                Example:
                  value:
                    data: 'otpauth://totp/MySite:john.doe?secret=GJTGC5LUNA'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                description: ''
                type: object
                x-examples:
                  example-1:
                    message: not a valid QR code
                properties:
                  message:
                    type: string
                    description: An information message
                required:
                  - message
              examples:
                Example:
                  value:
                    message: not a valid QR code
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      tags:
        - qrcode
components:
  schemas:
    2FAccountStore:
      title: 2FAccount
      type: object
      description: Expected informations to create or preview an account
      examples:
        - service: MySite
          account: john.doe
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          otp_type: totp
          secret: GJTGC5LUNA
          digits: 6
          algorithm: sha1
          period: 30
          counter: null
        - service: MySite
          account: john.doe
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          otp_type: hotp
          secret: GJTGC5LUNA
          digits: 6
          algorithm: sha1
          period: null
          counter: 0
        - account: john.doe
          otp_type: totp
      properties:
        service:
          type:
            - string
            - 'null'
          description: The Issuer of the 2FA account
          example: MySite
          pattern: '^[^:]+$'
        account:
          type: string
          description: The Label of the 2FA account
          example: john.doe
          pattern: '^[^:]+$'
        icon:
          type:
            - string
            - 'null'
          example: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          description: The filename of the icon which decorate the 2FA account
        otp_type:
          type: string
          enum:
            - totp
            - hotp
          example: totp
          description: The type of 2FA account
        secret:
          type:
            - string
            - 'null'
          description: A base32 encoded string used by the cryptographic algorithm to generate the One-Time Password.
          example: GJTGC5LUNA
        digits:
          type:
            - integer
            - 'null'
          example: 6
          description: The number of digits of the generated One-Time Password
        algorithm:
          type:
            - string
            - 'null'
          enum:
            - sha1
            - sha256
            - sha512
            - md5
          example: sha1
          description: The algorithm used to generate the One-Time Password
          default: sha1
        period:
          type:
            - integer
            - 'null'
          default: 30
          example: 30
          description: 'For TOTP only: The validity duration of One-Time Password generated for the account'
        counter:
          type:
            - integer
            - 'null'
          example: 15
          description: 'for HOTP only: The value of the counter used to synchronize the account with its verification servers'
          default: 0
      required:
        - account
        - otp_type
    2FAccountRead:
      description: A single 2-Factor-Auth (2FA) account
      x-examples:
        example-1:
          service: MySite
          account: john.doe
          otp_type: totp
          uri: ''
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          secret: GJTGC5LUNA
          secretIsBase32Encoded: 1
          algorithm: sha1
          digits: 6
          hotpCounter: null
          totpPeriod: 30
          imageLink: 'https://www.example.com/image.png'
      examples:
        - id: 1
          group_id: 1
          service: MySite
          account: john.doe
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          otp_type: totp
          secret: GJTGC5LUNA
          digits: 6
          algorithm: sha1
          period: 30
          counter: null
      title: ''
      allOf:
        - type: object
          properties:
            id:
              type:
                - integer
                - 'null'
              example: 1
              description: ID of the 2FA account
              minimum: 1
            group_id:
              type:
                - integer
                - 'null'
              example: 1
              description: The ID of the group the 2FA account belongs to
              minimum: 1
          required:
            - id
            - group_id
        - $ref: '#/components/schemas/2FAccountStore'
    2FAccountUpdate:
      title: 2FAccount
      type: object
      description: Expected informations to update a 2FA account
      examples:
        - service: MySite
          account: john.doe
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          otp_type: totp
          secret: GJTGC5LUNA
          digits: 6
          algorithm: sha1
          period: 30
        - service: MySite
          account: john.doe
          icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          otp_type: hotp
          secret: GJTGC5LUNA
          digits: 6
          algorithm: sha1
          counter: 0
      properties:
        service:
          type:
            - string
            - 'null'
          description: The Issuer of the 2FA account
          example: MySite
          pattern: '^[^:]+$'
        account:
          type: string
          description: The Label of the 2FA account
          example: john.doe
          pattern: '^[^:]+$'
        icon:
          type:
            - string
            - 'null'
          example: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
          description: The filename of the icon which decorate the 2FA account
        otp_type:
          type: string
          enum:
            - totp
            - hotp
          example: totp
          description: The type of 2FA account
        secret:
          type: string
          description: A base32 encoded string used by the cryptographic algorithm to generate the One-Time Password
          example: GJTGC5LUNA
        digits:
          type: integer
          example: 6
          description: The number of digits of the generated One-Time Password
        algorithm:
          type: string
          enum:
            - sha1
            - sha256
            - sha512
            - md5
          example: sha1
          description: The algorithm used to generate the One-Time Password
        period:
          type: integer
          example: 30
          description: 'Required for TOTP only: The validity duration of One-Time Password generated for the account'
        counter:
          type: integer
          example: 15
          description: 'Required for HOTP only: The value of the counter used to synchronize the account with its verification servers'
      required:
        - service
        - account
        - icon
        - otp_type
        - secret
        - digits
        - algorithm
    2FAccountCollection:
      title: TokenCollection
      description: An array of 2FA accounts
      examples:
        - - id: 1
            group_id: 1
            service: MySite
            account: john.doe
            icon: ZMlzmrPsrWSWVt4fZouFVrt2w38D0PnXiyZQvDcY.png
            otp_type: totp
            digits: 6
            algorithm: sha1
            secret: GJTGC5LUNA
            period: 30
            counter: null
          - id: 2
            group_id: 1
            service: MyOtherSite
            account: john.doe
            icon: 1pawLLuMx4bOQkrZxM5CIQyFtVq25dtgMkU3rtST.png
            otp_type: hotp
            digits: 8
            algorithm: sha1
            secret: QD5TG6UUJ89F44GV
            period: null
            counter: 15
      type: array
      items:
        $ref: '#/components/schemas/2FAccountRead'
    Otp:
      title: Otp
      type: object
      description: One-Time password
      examples:
        - password: '225897'
          generated_at: 1631304659
          valid_for: 30
        - password: '225897'
          counter: 5
      properties:
        password:
          type: string
          description: the One-Time Password
          minLength: 6
          maxLength: 10
          example: '225897'
        generated_at:
          type: integer
          description: 'TOTP only: The timestamp of the generation time'
          example: 1631304659
        valid_for:
          type: integer
          description: 'TOTP only: The validity period of the password'
          example: 30
        counter:
          type: integer
          description: 'HOTP only: The number of password computing iterations'
          example: 5
      required:
        - password
    OtpauthUri:
      title: OtpauthUri
      type: object
      examples:
        - uri: 'otpauth://totp/MySite:john.doe?secret=GJTGC5LUNA&issuer=MySite&period=30&algorithm=sha1&digits=6&image=https://www.example.com/image.png'
      properties:
        uri:
          type: string
          example: 'otpauth://totp/MySite:john.doe?secret=GJTGC5LUNA&issuer=MySite&period=30&algorithm=sha1&digits=6&image=https://www.example.com/image.png'
          pattern: '^otpauth:\/\/(totp|hotp)\/.+'
          format: uri
          description: A URI which describe a 2FA account (usually encoded as a QR code) following the otpauth format
      required:
        - uri
      description: An otpauth URI
    GroupRead:
      title: Group
      type: object
      description: A Group resource
      examples:
        - id: 1
          name: Social networks
          twofaccounts_count: 4
      properties:
        id:
          type: integer
          example: 1
          description: ID of the Group
          minimum: 0
        name:
          type: string
          example: Social networks
          description: Name of the Group
        twofaccounts_count:
          type: integer
          description: Number of 2FA accounts in the group
          minimum: 0
          example: 4
      required:
        - id
        - name
        - twofaccounts_count
    GroupStore:
      title: GroupStore
      type: object
      properties:
        name:
          type: string
          maxLength: 32
          example: Social networks
          description: The name of the group
      required:
        - name
      examples:
        - name: Social networks
      description: Expected informations to create a group
    GroupCollection:
      title: GroupCollection
      type: array
      items:
        $ref: '#/components/schemas/Group'
      description: An array of Groups
      examples:
        - - id: 0
            name: All
            twofaccounts_count: 9
          - id: 1
            name: Social networks
            twofaccounts_count: 4
  parameters:
    id:
      name: id
      in: path
      required: true
      schema:
        type: integer
        example: 1
        minimum: 1
      description: The ID of the resource
    withSecret:
      name: withSecret
      in: query
      required: false
      schema:
        type: boolean
      description: Set to true (or 1) to append the Secret property to the returned 2FA account
  responses:
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            type: object
            description: ''
            properties:
              message:
                type: string
                description: An information message
                example: Model not found
            required:
              - message
          examples:
            Example:
              value:
                message: Model not found
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: An information message
                example: Unauthenticated
            required:
              - message
          examples:
            Example:
              value:
                message: Unauthenticated.
    ValidationError:
      description: Validation errors
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: An information message
                example: The given data was invalid
              errors:
                description: A collection of fields with their respective errors
                type: object
                properties:
                  fieldName:
                    type: array
                    description: A field with errors
                    items:
                      type: string
                      example: The field2 must be a number
            required:
              - message
              - errors
          examples:
            Example:
              value:
                message: The given data was invalid.
                errors:
                  field1:
                    - The field1 is required.
                    - The field1 must be a string.
                  field2:
                    - The field2 must be a number.
    OK:
      description: OK
      content:
        application/json:
          schema:
            description: ''
            type: object
            x-examples:
              example-1:
                message: success
            properties:
              message:
                type: string
                description: An information message
                example: success
            required:
              - message
          examples:
            Example:
              value:
                message: success
    Authenticated:
      description: Authenticated
      content:
        application/json:
          schema:
            description: ''
            type: object
            x-examples:
              example-1:
                message: authenticated
                token: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiMWNiZThmODA3NDk4NDQ4Y2RkZWUwZjI5MGIxNzI4ZDk5MTRjM2JiMGY5YWNiYjZmMTI2YzZhMzk5NzA2NWM4MjgyZWYxYzE1MGE1OWM4OTciLCJpYXQiOiIxNjMwNDQ4MzIzLjI5OTYzOCIsIm5iZiI6IjE2MzA0NDgzMjMuMjk5NjQxIiwiZXhwIjoiMTY2MTk4NDMyMy4yOTI3OTciLCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.JiA505HgQPTpzvwY3tPvip7ZEDMlKGyRnTR4Zu1b7xYqY9b9Eff4KL-A6lX2uNMumt8ucg4M5iWwOe4gueXD7vqMhGO5GALl4daECo3-rG1-Jet7F8wlL7XqnhB-U_jiq387BRXwNdiNPNO2kepTTVY1MIXyMGVHBLwVuGXhbqrQSTPegT17Vy9JpnsQBejXUSSjN-3mZxUbn5EFZH6Nv4eYhN_QRTUwkSKV-rgYrzbWrw32AsImBYK-_yEoRZkkr1L61HwG2TBa2Wl0DdCzQeysIYWh5mzCR4ViiUP2J2PNFMP35QPI3ur6UEPJzEVzTGXftA76VijBShB7PLi9_F6VGempW4tTWa1FclB1vl45okO_s_YAIAfzgjJiJGkm2ThqXZAO8wlLWYcvyx2K_rxHtGOOU4NMabMo3omD6UQlETRZec17S7ZT10rhIzpgbZFcg56sEjhED9z3W2xN4NheXq27YrhB7EcJppXN8siIMbvakERe-N1obbVSDFLoId698zEZ68PBs_5t667HLKUH_EoMgCCuyCEIE9RVi41CWcbwgez-Ynz6RksIV9HfGXysHZzEXXfOW25kLmJMN5NUKiygxjG0sJ5F6pyIbVUTi5DmzUDxHdLKOOB3JqqKEtEeNtoSPTAW3XRIVf7sUxD54srGcxumk0TdYBIBerU
                name: bubka
            properties:
              message:
                type: string
                description: An information message
                example: success
              token:
                type: string
                description: An authentication token to set in requests header
                example: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiYjc1NjhmMTEyMDI4NzMwZDRhZTIyZDM2OTYwZTZlNzhjNzdhNDI2YThhZjZjODQ0MDY4YjM2NDBhM2E0YjI0ZWM5Y2E3ZjIwYzFhZWI3NDQiLCJpYXQiOiIxNjMwNDQzMzUwLjkwNjkwMyIsIm5iZiI6IjE2MzA0NDMzNTAuOTA2OTA2IiwiZXhwIjoiMTY2MTk3OTM1MC45MDA2NDIiLCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.NX59UK4gNksId6x3dBD4AD6zZcIwEjPcsFNG2Kko8_t1gxcI-x8UQJDafY61UAckfta5EzFjDNSVTJgHfmHHbegT_GAr5CzlmxRuLEiGKe9aJxCq7dfQgfQINGCS3c9gfmhW8I5tY2h6mKDvqCucjWxxqUdGzmPWb7GtLP0mhiO1mKs5G-FqReO6odU8aCqZG9mpc4mepqBA8KIlCtHdPwUbMlhaKrEaNcD4FtLFZsNtmNGDUku7pz7FKRB0ZRYK3C2WbnxeaYPdxJOdR79dz7pXIhDslvoLrYiE0tiWMBL3gUyj6YLFHldtJ3NbhUVPwjL4NXM-IAwV49vlUpRUOpB6BAl6CKNf6FOtm2bb95kIAVcX-U0l2_L60gevmc4h-BRjzYP9_s6rChwU8g9wCybwhy2qDSgqp_K4RRNr_IHbDMC7bz9cKvFMKDsYe8P9wFYj_0vX-2o3z1y-sJr6Asjz1cX3bdhvFa_UHYMVPju-sI49LaRc1VE2C7tsn4E5sZuiko4W7KjjzyKwmvCN1JeAmwe4G2OQs42NJR_BBhjZ0aDJxvFiefCYfkFuCD6PJPw5lGKowvSmuyRgIIRk0fi6kOYy9dQ9mZEZz5HKUQj2jrogQQbFqKsVbHPH8A7Qvhc2jEQIRWhodTUDfp_TV3iywcS7qU2AYlhTNAoi9zo
              name:
                type: string
                description: The authenticated account username
                example: john.doe
            required:
              - message
              - token
              - name
          examples:
            Example:
              value:
                message: success
                token: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiYjc1NjhmMTEyMDI4NzMwZDRhZTIyZDM2OTYwZTZlNzhjNzdhNDI2YThhZjZjODQ0MDY4YjM2NDBhM2E0YjI0ZWM5Y2E3ZjIwYzFhZWI3NDQiLCJpYXQiOiIxNjMwNDQzMzUwLjkwNjkwMyIsIm5iZiI6IjE2MzA0NDMzNTAuOTA2OTA2IiwiZXhwIjoiMTY2MTk3OTM1MC45MDA2NDIiLCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.NX59UK4gNksId6x3dBD4AD6zZcIwEjPcsFNG2Kko8_t1gxcI-x8UQJDafY61UAckfta5EzFjDNSVTJgHfmHHbegT_GAr5CzlmxRuLEiGKe9aJxCq7dfQgfQINGCS3c9gfmhW8I5tY2h6mKDvqCucjWxxqUdGzmPWb7GtLP0mhiO1mKs5G-FqReO6odU8aCqZG9mpc4mepqBA8KIlCtHdPwUbMlhaKrEaNcD4FtLFZsNtmNGDUku7pz7FKRB0ZRYK3C2WbnxeaYPdxJOdR79dz7pXIhDslvoLrYiE0tiWMBL3gUyj6YLFHldtJ3NbhUVPwjL4NXM-IAwV49vlUpRUOpB6BAl6CKNf6FOtm2bb95kIAVcX-U0l2_L60gevmc4h-BRjzYP9_s6rChwU8g9wCybwhy2qDSgqp_K4RRNr_IHbDMC7bz9cKvFMKDsYe8P9wFYj_0vX-2o3z1y-sJr6Asjz1cX3bdhvFa_UHYMVPju-sI49LaRc1VE2C7tsn4E5sZuiko4W7KjjzyKwmvCN1JeAmwe4G2OQs42NJR_BBhjZ0aDJxvFiefCYfkFuCD6PJPw5lGKowvSmuyRgIIRk0fi6kOYy9dQ9mZEZz5HKUQj2jrogQQbFqKsVbHPH8A7Qvhc2jEQIRWhodTUDfp_TV3iywcS7qU2AYlhTNAoi9zo
                name: john.doe
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            description: ''
            type: object
            x-examples:
              example-1:
                message: success
            properties:
              message:
                type: string
                description: An information message
                example: bad request
              reason:
                type: object
                description: The reasons why the error occured
                properties:
                  param1:
                    type: string
                    description: A reason
                    example: This request accept only one parameter
            required:
              - message
          examples:
            Example:
              value:
                message: bad request
                reason:
                  param1: This request accept only one parameter
tags:
  - name: auth
  - name: groups
  - name: icons
  - name: One-Time Password
  - name: qrcode
  - name: twofaccounts
